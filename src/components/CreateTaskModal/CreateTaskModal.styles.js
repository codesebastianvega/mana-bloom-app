// [MB] Modulo: Tasks / Seccion: CreateTaskModal
// Afecta: CreateTaskModal
// Proposito: Estilos del modal para crear y editar tareas
// Puntos de edicion futura: tokens en theme y ajustes de spacing
// Autor: Codex - Fecha: 2025-10-20

import { StyleSheet } from "react-native";
import { Colors, Spacing, Radii, Elevation, Typography } from "../../theme";

const withAlpha = (hex = "", alpha = 1) => {
  if (!hex) return hex;
  const cleaned = `${hex}`.replace("#", "").trim();
  const base = cleaned.length === 8 ? cleaned.slice(0, 6) : cleaned;
  if (base.length !== 6) return hex;
  const value = parseInt(base, 16);
  const r = (value >> 16) & 255;
  const g = (value >> 8) & 255;
  const b = value & 255;
  return `rgba(${r},${g},${b},${alpha})`;
};

const glassPanel = "#1d1c2a";
const glassSurface = "transparent";
const glassDeep = "transparent";
const borderSoft = withAlpha(Colors.primaryLight, 0.28);
const borderStrong = withAlpha(Colors.primaryLight, 0.55);

const shadowSoft = {
  shadowColor: Colors.shadow,
  shadowOpacity: 0.18,
  shadowRadius: 8,
  shadowOffset: { width: 0, height: 4 },
};

const chipBase = {
  minHeight: Spacing.base + Spacing.small,
  paddingHorizontal: Spacing.small + Spacing.tiny,
  borderRadius: Radii.pill,
  borderWidth: 1,
  borderColor: borderSoft,
  backgroundColor: glassSurface,
  flexDirection: "row",
  alignItems: "center",
  justifyContent: "center",
  gap: Spacing.tiny,
  ...shadowSoft,
};

const inputBase = {
  borderRadius: Radii.lg,
  backgroundColor: glassSurface,
  borderWidth: 1,
  borderColor: borderSoft,
  paddingHorizontal: Spacing.base,
  color: Colors.text,
  ...shadowSoft,
};

export default StyleSheet.create({
  modalOverlay: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    backgroundColor: "rgba(3, 0, 12, 0.85)",
    paddingHorizontal: Spacing.small,
    paddingVertical: Spacing.small / 2,
  },
  root: {
    width: "100%",
    maxWidth: 440,
    height: "92%",
    maxHeight: 800,
    alignSelf: "center",
    backgroundColor: glassPanel,
    borderRadius: Radii.xl * 1.3,
    padding: 0,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.3),
    shadowColor: Colors.shadow,
    shadowOpacity: 0.4,
    shadowRadius: 30,
    shadowOffset: { width: 0, height: 20 },
    elevation: 20,
    overflow: "hidden",
  },
  heroRow: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
    borderBottomWidth: 1,
    borderBottomColor: withAlpha(Colors.primaryLight, 0.15),
    backgroundColor: "#2f2d4a",
    borderTopLeftRadius: Radii.xl,
    borderTopRightRadius: Radii.xl,
  },
  heroTitle: {
    fontSize: 22,
    fontWeight: "800",
    color: Colors.text,
    letterSpacing: 0.1,
  },
  heroSubtitle: {
    ...Typography.caption,
    color: withAlpha(Colors.textMuted, 0.9),
    letterSpacing: 1.5,
    marginTop: 1,
    fontSize: 11,
    fontWeight: "600",
  },
  contentContainer: {
    paddingHorizontal: Spacing.base,
    paddingTop: Spacing.base,
    paddingBottom: Spacing.base,
  },
  closeButton: {
    width: 32,
    height: 32,
    borderRadius: 16,
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: withAlpha(Colors.surface, 0.4),
    borderWidth: 1,
    borderColor: withAlpha(Colors.textMuted, 0.3),
  },
  sectionLabel: {
    ...Typography.body,
    fontSize: Typography.body.fontSize + 1,
    fontWeight: "700",
    color: Colors.text,
    letterSpacing: 0.2,
    marginTop: Spacing.base,
    marginBottom: Spacing.tiny,
  },
  sectionLabelUpper: {
    textTransform: "uppercase",
    letterSpacing: 1.1,
  },
  helperText: {
    ...Typography.caption,
    color: Colors.textMuted,
    marginTop: Spacing.tiny,
    marginBottom: Spacing.small / 2,
  },
  row: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
  },
  group: {
    marginTop: Spacing.base,
    gap: Spacing.small / 2,
  },
  inputGroup: {
    marginTop: Spacing.small,
    gap: Spacing.tiny,
  },
  input: {
    height: 48,
    borderBottomWidth: 1,
    borderBottomColor: withAlpha(Colors.primaryLight, 0.25),
    paddingHorizontal: 0,
    paddingVertical: Spacing.tiny,
    color: Colors.text,
    fontSize: 22,
    fontWeight: "800",
    letterSpacing: 0.2,
    backgroundColor: "transparent",
    marginTop: -10,
  },
  inputActive: {
    borderBottomColor: Colors.primary,
    borderBottomWidth: 2,
  },
  inputMultiline: {
    minHeight: 110,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.2),
    backgroundColor: "#2f2d4a",
    paddingHorizontal: Spacing.base,
    paddingTop: Spacing.base,
    textAlignVertical: "top",
    color: Colors.text,
    marginBottom: -10,
  },
  inputMultilineActive: {
    borderColor: Colors.primary,
    backgroundColor: "#382f59",
  },
  segmentContainer: {
    flexDirection: "row",
    gap: Spacing.small,
    marginTop: Spacing.small,
  },
  segmentButton: {
    flex: 1,
    alignItems: "center",
    justifyContent: "center",
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.35),
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.6),
    paddingVertical: Spacing.small + Spacing.tiny,
    paddingHorizontal: Spacing.base,
  },
  segmentButtonActive: {
    borderColor: withAlpha(Colors.primary, 0.8),
    backgroundColor: withAlpha(Colors.primary, 0.2),
  },
  segmentLabel: {
    ...Typography.caption,
    fontSize: Typography.caption.fontSize + 1,
    fontWeight: "600",
    color: Colors.text,
    letterSpacing: 0.2,
  },
  segmentLabelActive: {
    color: Colors.primaryLight,
  },
  elementDescriptor: {
    ...Typography.caption,
    color: withAlpha(Colors.text, 0.9),
    lineHeight: 16,
  },
  elementGrid: {
    width: "100%",
    marginTop: Spacing.small,
    paddingHorizontal: Spacing.tiny,
  },
  elementRow: {
    flexDirection: "row",
    gap: Spacing.small,
    width: "100%",
  },
  elementTile: {
    flex: 1,
    minWidth: 0,
    height: 96,
    alignItems: "center",
    justifyContent: "center",
    borderRadius: Radii.lg * 1.3,
    borderWidth: 1,
    paddingHorizontal: Spacing.small,
    paddingVertical: Spacing.small,
  },
  elementTitle: {
    ...Typography.label,
    color: Colors.text,
    fontSize: 12,
    letterSpacing: 1,
    textAlign: "center",
  },
  chip: {
    ...chipBase,
  },
  chipActive: {
    borderColor: borderStrong,
    backgroundColor: withAlpha(Colors.primaryLight, 0.24),
    shadowColor: Colors.primaryLight,
    shadowOpacity: 0.28,
    shadowRadius: 10,
  },
  chipLabel: {
    ...Typography.caption,
    fontWeight: "600",
    color: Colors.text,
  },
  chipLabelActive: {
    color: Colors.text,
  },
  difficultyGrid: {
    flexDirection: "row",
    flexWrap: "wrap",
    columnGap: Spacing.small - Spacing.tiny,
    rowGap: Spacing.small - Spacing.tiny,
    marginTop: Spacing.small,
  },
  difficultyTile: {
    flexBasis: "47%",
    maxWidth: "47%",
    minHeight: 42,
    borderRadius: Radii.lg * 0.9,
    borderWidth: 1,
    borderColor: borderSoft,
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.45),
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: Spacing.small / 1.6,
  },
  difficultyTileLabel: {
    ...Typography.body,
    color: Colors.text,
    fontWeight: "600",
    letterSpacing: 0.4,
  },
  frequencyGrid: {
    flexDirection: "row",
    flexWrap: "wrap",
    columnGap: Spacing.small - Spacing.tiny,
    rowGap: Spacing.small - Spacing.tiny,
    marginTop: Spacing.small,
    justifyContent: "space-between",
  },
  frequencyTile: {
    flexBasis: "48%",
    maxWidth: "48%",
    minHeight: 42,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: borderSoft,
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.45),
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: Spacing.small / 1.3,
  },
  frequencyTileActive: {
    borderColor: Colors.primary,
    backgroundColor: withAlpha(Colors.primary, 0.2),
    shadowColor: Colors.primary,
    shadowOpacity: 0.18,
    shadowRadius: 8,
    shadowOffset: { width: 0, height: 4 },
  },
  frequencyLabel: {
    ...Typography.body,
    color: Colors.text,
    fontWeight: "600",
    textAlign: "center",
    width: "100%",
  },
  frequencyLabelActive: {
    color: Colors.primaryLight,
    fontWeight: "700",
  },
  subtaskCard: {
    marginTop: Spacing.small,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.2),
    backgroundColor: withAlpha(Colors.surfaceElevated, 0.62),
    overflow: "hidden",
  },
  subtaskEmpty: {
    ...Typography.caption,
    color: Colors.textMuted,
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
  },
  subtaskRowLine: {
    flexDirection: "row",
    alignItems: "center",
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
    gap: Spacing.small,
    borderBottomWidth: 1,
    borderBottomColor: withAlpha(Colors.primaryLight, 0.12),
  },
  subtaskRowLineLast: {
    borderBottomWidth: 0,
  },
  subtaskCheckbox: {
    width: 20,
    height: 20,
    borderRadius: 6,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.35),
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: withAlpha(Colors.surface, 0.7),
  },
  subtaskCheckboxActive: {
    borderColor: Colors.primary,
    backgroundColor: Colors.primary,
  },
  subtaskText: {
    ...Typography.body,
    flex: 1,
    color: Colors.text,
  },
  subtaskTextCompleted: {
    color: Colors.textMuted,
    textDecorationLine: "line-through",
  },
  subtaskRemove: {
    padding: Spacing.tiny,
  },
  subtaskInputRow: {
    flexDirection: "row",
    alignItems: "center",
    gap: Spacing.small,
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.5),
  },
  subtaskAddBtn: {
    width: 36,
    height: 36,
    borderRadius: 18,
    alignItems: "center",
    justifyContent: "center",
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.35),
    backgroundColor: withAlpha(Colors.primary, 0.35),
  },
  subtaskInlineInput: {
    flex: 1,
    color: Colors.text,
    fontSize: Typography.body.fontSize + 1,
  },
  priorityGrid: {
    flexDirection: "row",
    flexWrap: "wrap",
    columnGap: Spacing.small - Spacing.tiny,
    rowGap: Spacing.small - Spacing.tiny,
    marginTop: Spacing.small,
    justifyContent: "space-between",
  },
  priorityTile: {
    flexBasis: "47%",
    maxWidth: "47%",
    minHeight: 42,
    borderRadius: Radii.lg * 0.9,
    borderWidth: 1,
    borderColor: borderSoft,
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.45),
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: Spacing.small / 1.6,
  },
  priorityTilePlaceholder: {
    flexBasis: "47%",
    maxWidth: "47%",
    minHeight: 42,
  },
  priorityTileLabel: {
    ...Typography.body,
    fontWeight: "600",
    color: Colors.text,
    letterSpacing: 0.6,
  },
  selectorRow: {
    flexDirection: "row",
    gap: Spacing.base,
    marginTop: Spacing.base,
  },
  selectorColumn: {
    flex: 1,
  },
  selectionControl: {
    minHeight: 44,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.25),
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.55),
    paddingHorizontal: Spacing.base,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    marginTop: Spacing.small / 2,
  },
  selectionValue: {
    ...Typography.body,
    fontWeight: "600",
    color: Colors.text,
  },
  selectionMenu: {
    marginTop: Spacing.tiny,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.2),
    backgroundColor: withAlpha(Colors.surfaceElevated, 0.95),
    overflow: "hidden",
  },
  dropdownOverlay: {
    position: "absolute",
    zIndex: 10,
    backgroundColor: "transparent",
  },
  selectionMenuFloating: {
    position: "absolute",
    top: 0,
    width: "100%",
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.2),
    backgroundColor: withAlpha(Colors.surfaceElevated, 0.95),
    maxHeight: 220,
  },
  selectionOption: {
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
    borderBottomWidth: 1,
    borderBottomColor: withAlpha(Colors.primaryLight, 0.1),
  },
  selectionOptionActive: {
    backgroundColor: withAlpha(Colors.primary, 0.12),
    borderLeftWidth: 3,
    borderLeftColor: Colors.primary,
  },
  selectionOptionLabel: {
    ...Typography.body,
    color: Colors.text,
  },
  tipCard: {
    marginTop: Spacing.tiny,
    padding: Spacing.small,
    borderRadius: Radii.md,
    borderLeftWidth: 3,
    borderLeftColor: Colors.info,
    backgroundColor: withAlpha(Colors.info, 0.12),
  },
  tipTitle: {
    ...Typography.caption,
    color: Colors.text,
  },
  tipBody: {
    ...Typography.caption,
    color: Colors.textMuted,
    marginTop: Spacing.tiny / 2,
  },
  tagsList: {
    flexDirection: "row",
    flexWrap: "wrap",
    gap: Spacing.small - Spacing.tiny,
    marginTop: Spacing.small,
  },
  tagCard: {
    marginTop: Spacing.small,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.2),
    backgroundColor: withAlpha(Colors.surfaceElevated, 0.62),
    overflow: "hidden",
  },
  tagEmpty: {
    ...Typography.caption,
    color: Colors.textMuted,
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
  },
  tagRowLine: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
    borderBottomWidth: 1,
    borderBottomColor: withAlpha(Colors.primaryLight, 0.12),
  },
  tagRowLineLast: {
    borderBottomWidth: 0,
  },
  tagRowText: {
    ...Typography.body,
    color: Colors.text,
    fontWeight: "600",
  },
  tagRowAction: {
    width: 32,
    height: 32,
    borderRadius: 16,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.35),
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.5),
    alignItems: "center",
    justifyContent: "center",
  },
  tagInputRow: {
    flexDirection: "row",
    alignItems: "center",
    gap: Spacing.small,
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.45),
    borderTopWidth: 1,
    borderTopColor: withAlpha(Colors.primaryLight, 0.12),
  },
  tagInputField: {
    flex: 1,
    color: Colors.text,
    fontSize: Typography.body.fontSize + 1,
  },
  tagAddBtn: {
    width: 34,
    height: 34,
    borderRadius: 17,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.35),
    backgroundColor: withAlpha(Colors.primary, 0.35),
    alignItems: "center",
    justifyContent: "center",
  },
  tagChip: {
    ...chipBase,
  },
  tagText: {
    ...Typography.caption,
    color: Colors.text,
  },
  actions: {
    flexDirection: "row",
    alignItems: "center",
    gap: Spacing.small,
    marginTop: Spacing.base - Spacing.tiny,
  },
  primaryButton: {
    flex: 2,
    minHeight: 40,
    borderRadius: Radii.lg,
    overflow: "hidden",
  },
  primaryButtonGradient: {
    flex: 1,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: Spacing.small,
    paddingHorizontal: Spacing.large,
    borderRadius: Radii.lg,
    shadowColor: Colors.primary,
    shadowOpacity: 0.3,
    shadowRadius: 10,
    shadowOffset: { width: 0, height: 6 },
  },
  primaryButtonLabel: {
    ...Typography.body,
    fontSize: Typography.body.fontSize + 1,
    fontWeight: "800",
    color: Colors.text,
    letterSpacing: 0.2,
  },
  secondaryButton: {
    flex: 1,
    minHeight: 40,
    paddingHorizontal: Spacing.base,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.35),
    backgroundColor: withAlpha(Colors.surfaceElevated, 0.72),
    justifyContent: "center",
    alignItems: "center",
  },
  secondaryButtonLabel: {
    ...Typography.body,
    fontWeight: "500",
    color: Colors.textMuted,
    letterSpacing: 0.2,
  },
  divider: {
    height: 1,
    backgroundColor: withAlpha(Colors.primaryLight, 0.2),
    marginVertical: Spacing.base,
    borderRadius: 1,
  },
  chipRow: {
    flexDirection: "row",
    gap: Spacing.small,
    flexWrap: "wrap",
    marginTop: Spacing.small,
  },
  dateChip: {
    paddingHorizontal: Spacing.base + Spacing.tiny,
    paddingVertical: Spacing.small,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.2),
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.3),
    minWidth: 120,
    alignItems: "center",
    justifyContent: "center",
  },
  dateChipActive: {
    borderColor: Colors.accent,
    backgroundColor: withAlpha(Colors.accent, 0.2),
    shadowColor: Colors.accent,
    shadowOpacity: 0.3,
    shadowRadius: 10,
    shadowOffset: { width: 0, height: 4 },
  },
  dateChipText: {
    ...Typography.caption,
    fontWeight: "600",
    color: Colors.textMuted,
    fontSize: 12,
    letterSpacing: 0.3,
    textAlign: "center",
  },
  dateChipTextActive: {
    color: Colors.accent,
  },
  durationChip: {
    flex: 1,
    minWidth: 0,
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.2),
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.3),
    alignItems: "center",
  },
  durationChipActive: {
    borderColor: Colors.primary,
    backgroundColor: withAlpha(Colors.primary, 0.2),
    shadowColor: Colors.primary,
    shadowOpacity: 0.3,
    shadowRadius: 8,
    shadowOffset: { width: 0, height: 2 },
  },
  chipLabelActive: {
    color: Colors.primaryLight,
  },
  sectionHelperCard: {
    marginTop: Spacing.small,
    borderRadius: Radii.md,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.25),
    backgroundColor: withAlpha(Colors.surfaceElevated, 0.7),
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.small,
  },
  elementHelperCard: {
    borderLeftWidth: 3,
    borderLeftColor: Colors.primary,
  },
  elementHelperTitle: {
    ...Typography.caption,
    fontWeight: "700",
    marginBottom: Spacing.tiny / 2,
  },
  sectionHelperTitle: {
    ...Typography.caption,
    fontWeight: "700",
    letterSpacing: 0.6,
    color: Colors.text,
    marginBottom: Spacing.tiny / 2,
  },
  footerSection: {
    paddingHorizontal: Spacing.base,
    paddingBottom: Spacing.base,
    paddingTop: Spacing.base,
    borderTopWidth: 0.5,
    borderTopColor: withAlpha(Colors.primaryLight, 0.15),
    gap: Spacing.large,
    backgroundColor: "#2f2d4a",
  },
  rewardBanner: {
    flexDirection: "row",
    alignItems: "center",
    gap: Spacing.base,
    paddingHorizontal: Spacing.base,
    paddingVertical: Spacing.base / 2,
    borderRadius: Radii.lg,
    borderWidth: 1,
    borderColor: withAlpha(Colors.primaryLight, 0.25),
    backgroundColor: withAlpha(Colors.surfaceAlt, 0.4),
    shadowColor: Colors.primary,
    shadowOpacity: 0.15,
    shadowRadius: 18,
    shadowOffset: { width: 0, height: 10 },
    marginBottom: -20,
  },
  rewardIcon: {
    width: 44,
    height: 44,
    borderRadius: 22,
    alignItems: "center",
    justifyContent: "center",
    shadowColor: Colors.accent,
    shadowOpacity: 0.4,
    shadowRadius: 12,
    shadowOffset: { width: 0, height: 6 },
  },
  rewardIconEmoji: {
    fontSize: 18,
    color: Colors.onAccent,
  },
  rewardIconEmoji: { fontSize: 18 },
  rewardLabel: {
    ...Typography.caption,
    fontSize: 11,
    fontWeight: "700",
    color: Colors.text,
    letterSpacing: 1,
    marginBottom: Spacing.tiny / 2,
  },
  rewardValues: {
    flexDirection: "row",
    gap: Spacing.base,
    alignItems: "baseline",
  },
  rewardXp: {
    ...Typography.body,
    fontSize: 12,
    fontWeight: "800",
    color: Colors.text,
  },
  rewardMana: {
    ...Typography.body,
    fontSize: 12,
    fontWeight: "800",
    color: Colors.info,
  },
  rewardGems: {
    ...Typography.body,
    fontSize: 12,
    fontWeight: "800",
    color: Colors.accent,
  },
});
